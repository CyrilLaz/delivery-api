# delivery-api

Бэкенд-приложение службы доставки.

[Тех. задание.](https://github.com/netology-code/ndse-diplom)

## Особенности

- В качестве базы данных используется `MongoDB`.
- Пароль храниться в хешированном виде.
- Для реализации аутентификации пользователя используется механизм сессий и модуль `Passport.js`.
- Обработка загруженных файлов производиться с помощью библиотеки `multer`.
- для онлайн-общения пользователей используется библиотека `Socket.IO`.

## Инструкция по запуску

Для запуска приложения требуется `Docker` и оформленный файл `.env`.

`npm run start` - запускает с помощью Докера базу данных и само приложение.

## Функционал

- `POST /api/signup` — зарегистрироваться;
- `POST /api/signin` — залогиниться;
- `GET /api/advertisements` - получить список объявлений;
- `GET /api/advertisements/:id` — получить данные объявления по id;
- `POST /api/advertisements` — создать объявление;
- `DELETE /api/advertisements/:id` — удалить объявление.

## Socket.io события

Сообщения, приходящие в socket:

- `getHistory` — получить историю сообщений из чата;
- `sendMessage` — отправить сообщение пользователю.

События, отправляемые через socket:

- `newMessage` — отправлено новое сообщение;
- `chatHistory` — ответ на событие `getHistory`.

## Переменные окружения

- `SESSION_SECRET= String` - строка для шифрования сессии пользователя.
- `PORT= Number` - номер порта для запуска приложения. Default: 3000.
- `UPLOAD_FOLDER= String` - название папки для загружаемых файлов. Default: `data`.
- `MONGO_URL= String` - url для доступа к базе данных MongoDB. Default: `mongodb://mongodb/delivery`.
- `CORS_ORIGIN= [String]` - массив url имеющих доступ к ресурсам приложения. Default: `["http://localhost:5500", "http://localhost:5501", "http://127.0.0.1:5500", "http://127.0.0.1:5501" ]`;
- `DOCKER_PORT= Number` - номер порта для внешнего доступа к приложению из docker-контейнера.

---

Список переменных окружения описан в файле `.env-example`.
